---
# Test playbook requiring variables for PAR acceptance tests
# Purpose: Test playbook_vars parameter functionality
# Expected: Succeeds when target_file variable is provided, fails otherwise

- name: Playbook with variables test
  hosts: localhost
  connection: local
  gather_facts: false
  
  tasks:
    - name: Validate required variable
      ansible.builtin.assert:
        that:
          - target_file is defined
          - target_file | length > 0
        fail_msg: "Variable 'target_file' must be defined and non-empty"
        success_msg: "Variable 'target_file' is set to {{ target_file }}"
      changed_when: false
    
    - name: Create test file
      ansible.builtin.copy:
        content: "PAR test content\n"
        dest: "{{ target_file }}"
        mode: '0644'
      changed_when: true
    
    - name: Verify file was created
      ansible.builtin.stat:
        path: "{{ target_file }}"
      register: file_stat
      changed_when: false
    
    - name: Display result
      ansible.builtin.debug:
        msg: "Successfully created file: {{ target_file }}"
      when: file_stat.stat.exists
      changed_when: false
